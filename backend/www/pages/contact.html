<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/contact.css">
    <script src="js/main.js"></script>
    <title>Contactos</title>

</head>

<body>
    <div class="container_contact">
        <button style="position: absolute; top: 4%; left: 8%; transform: translate(-50%, -50%);"
            onclick="goBack()">Voltar</button>
        <form id="contact-form" action="/contact" method="post">
            <h1>Contactos</h1>

            <label class="switch">
                <input id="switchon" type="checkbox" onclick="mySwitch()">
                <span class="slider round"></span>
            </label>

            <span>Entre em contato conosco</span>
            <input type="email" placeholder="Email" name="email" />
            <input type="text" placeholder="Cabeçalho" name="cabecalho" />
            <input type="text" placeholder="Corpo do E-mail" class="input_corpo" name="text_mail" />
            <button type="submit">Enviar</button>
        </form>
    </div>
    <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <p id="modalText"></p>
        </div>
    </div>
</body>

<script>

    window.onload = checkCookie()

    // Adiciona um ouvinte de evento 'submit' ao formulário com o id 'contact-form'
    document.getElementById('contact-form').addEventListener('submit', function (event) {
        // Previne o comportamento padrão do evento 'submit', que é recarregar a página
        event.preventDefault();

        // Obtém os valores dos campos do formulário
        var email = document.querySelector('input[name="email"]').value;
        var cabecalho = document.querySelector('input[name="cabecalho"]').value;
        var text_mail = document.querySelector('input[name="text_mail"]').value;

        // Cria um objeto com os dados do formulário
        var data = { email, cabecalho, text_mail };

        // Envia uma solicitação POST para o servidor
        fetch('/contact', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data), // Converte os dados do formulário em uma string JSON
        })
            .then(response => {

                var modal = document.getElementById("myModal");
                var span = document.getElementsByClassName("close")[0];
                var text = document.getElementById("modalText");

                // Verifica o código de status da resposta
                if (response.status === 200) {
                    text.innerHTML = 'E-mail enviado com sucesso!';
                    modal.style.display = "block";
                    
                } else if (response.status === 500) {
                    ext.innerHTML = 'Erro ao enviar o e-mail. Por favor, tente novamente.';
                    modal.style.display = "block";
                }

                span.onclick = function() {
                    modal.style.display = "none";
                    // Redireciona o usuário para a página de login
                    window.location.href = '/';
                }

                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                        // Redireciona o usuário para a página de login
                        window.location.href = '/';
                    }
                }

                // Retorna o corpo da resposta como texto
                return response.text();
            })
            .then(data => {
                // Loga o corpo da resposta no console
                console.log('Sucesso:', data);
            })
            .catch((error) => {
                // Loga qualquer erro que ocorra durante a solicitação no console
                console.error('Erro:', error);
            });
    });

</script>

</html>