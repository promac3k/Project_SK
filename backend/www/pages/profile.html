<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/index.css">
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/profile.css">
  <script src="js/main.js"></script>
  <title>Perfil</title>
</head>

<body>
  <!-- Modal Erro ao alterar Palavra-Passe -->
  <div id="modal_erro" class="modal_erro">
    <div class="modal_erro_content">
      <span id="modalText"></span>
    </div>
  </div>
  <main>
    <div class="container_profile">

      <nav>
        <ul>
          <li style="margin-left: 1.3rem; margin-right: auto;"><a href="/">Inicio</a></li>
          <li><a href="/contact">Contacto</a></li>
          <li><a href="/eventos">Eventos</a></li>
          <li class="adada"><a href="/perfil">Perfil</a></li>
        </ul>
      </nav>

      <div class="profile_info">
        <h1 id="nome"></h1>
        <img
          src="https://imgs.search.brave.com/wVvWqZjpOgQq0WR4gQEDL5FbT9OcgL64hPnC7RoI33o/rs:fit:860:0:0/g:ce/aHR0cHM6Ly9zdGF0/aWMtMDAuaWNvbmR1/Y2suY29tL2Fzc2V0/cy4wMC9wcm9ncmFt/bWVyLWljb24tMTAy/NHgxMDI0LW93ZTIy/bzd0LnBuZw"
          alt="" style="width:80%" class>
        <p class="title" id="curso"></p>
        <p class="title" id="turma"></p>
        <p class="title_2">ESTS</p>
      </div>
      <div class="profile_settings">
        <span>
          <div class="social-container">
            <label class="switch_profile">
              <input id="switchon" type="checkbox" onclick="mySwitch()">
              <span class="slider round"></span>
            </label>
          </div>
        </span>
        <span id="hoverText" onmouseover="changeColor()" onmouseout="resetColor()" style="cursor: pointer;"
          onclick="document.getElementById('modal_editar').style.display='block'"><img width="40" height="40"
            src="https://img.icons8.com/material-rounded/40/settings.png" alt="settings" />
          </svg></span>
        <a href="/logout"><span><img width="40" height="40" src="https://img.icons8.com/windows/40/exit.png"
              alt="exit" /></span></a>

      </div>

      <!-- Modal Editar Palavra-Passe -->
      <div id="modal_editar" class="modal">
        <div class="modal_conteudo">
          <div class="modal-header">
            <h1>Alterar Palavra-Passe</h1>

            <span class="fechar_editar">&times;</span>
          </div>

          <div class="modal-content">
            <div class="container_Pass">
              <form id="change-password-form" action="/change-password" method="post">
                <label for="lname">Palavra-Passe Antiga:</label><br>
                <input type="password" name="pass_antiga" class="input_campo"><br>
                <label for="lname">Nova Palavra-Passe:</label><br>
                <input type="password" name="pass_nova" class="input_campo"><br>
                <label for="email">Confirmar Palavra-Passe:</label><br>
                <input type="password" name="pass_confirme" class="input_campo"><br>
                <button type="submit" class="button_contacto"
                  onclick="document.getElementById('modal_erro').style.display='block'">Gravar </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-container" id="tabelaContainer">

        <table class="table_alunos">
          <tr class="tr_alunos">
            <th>Horas</th>
            <th>Segunda</th>
            <th>Terça</th>
            <th>Quarta</th>
            <th>Quinta</th>
            <th>Sexta</th>
          </tr>

          <tr class="tr_alunos">
            <td>08:00 - 08:30</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>08:30 - 09:00</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="tr_alunos">
            <td>09:00 - 09:30</td>
            <td rowspan="8" class="table_aula_segunda">CIC (Teorica)<br>1ºPWDAM-01<br>F315----LT</td>
            <td rowspan="8" class="table_aula_terca">IPINT (TP)<br>1ºPWDAM-01<br>D108-----JVJ</td>
            <td rowspan="8" class="table_aula_quarta">FM (TP)<br>1ºPWDAM-01<br>F315-----ECSL</td>
            <td rowspan="8" class="table_aula_quinta">ING (TP)<br>1ºPWDAM-01<br>F315-----ECSL</td>
            <td rowspan="8" class="table_aula_sexta">SGBD (TP)<br>1ºPWDAM-01<br>F315-----ND_DSI_INF_01</td>
          </tr>
          <tr class="tr_alunos">
            <td>09:30 - 10:00</td>
          </tr>
          <tr class="tr_alunos">
            <td>10:00 - 10:30</td>
          </tr>
          <tr class="tr_alunos">
            <td>10:30 - 11:00</td>
          </tr>
          <tr class="tr_alunos">
            <td>11:00 - 11:30</td>
          </tr>
          <tr class="tr_alunos">
            <td>11:30 - 12:00</td>
          </tr>
          <tr class="tr_alunos">
            <td>12:00 - 12:30</td>
          </tr>
          <tr class="tr_alunos">
            <td>12:30 - 13:00</td>
          </tr>
          <tr class="tr_alunos">
            <td>13:00 - 13:30</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>

          <tr class="tr_alunos">
            <td>13:30 - 14:00</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </table>

      </div>
      <div class="legenda_profile">

        <ul>

          <li><span class="cor1">
              <div class="rectangle1"></div>
            </span>recl - Aulas Prátricas</li>
          <li><span class="cor2">
              <div class="rectangle2"></div>
            </span>recl - Aulas téorico</li>

        </ul>
      </div>

      <footer>
        <p>
          Criado <i class="fa fa-heart"></i> por
          André Nunes, Diogo Oliveira, Gustavo Antunes, Sebastião Costa e Tiago Batista
        </p>
      </footer>
    </div>
  </main>
</body>

</html>

<script>

  window.onload = checkCookie();



  // vai buscar o id do modal
  var modal_editar = document.getElementById("modal_editar");

  // vai buscar a class do botao para fechar o modal
  var span = document.getElementsByClassName("fechar_editar")[0];

  //fecha o modal quando o botao dentro do modal for clicado
  span.onclick = function () {
    modal_editar.style.display = "none";
  }

  function changeColor() {
    document.getElementById('hoverText').style.color = 'red';
  }

  function resetColor() {
    var bodyStyles = window.getComputedStyle(document.body);
    var currentColor = bodyStyles.getPropertyValue('--text-color');
    document.getElementById('hoverText').style.color = currentColor;
  }

  function getCookie(name) {

    const value = "; " + document.cookie;
    const parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();

  }

  const userCookie = getCookie('user');
  if (userCookie) {
    const user = JSON.parse(decodeURIComponent(userCookie));
    document.getElementById('nome').textContent = user.nome;
    document.getElementById('turma').textContent = user.turma;
    document.getElementById('curso').textContent = user.curso;
  }

  document.getElementById('change-password-form').addEventListener('submit', function (event) {
    event.preventDefault();

    var pass_antiga = document.querySelector('input[name="pass_antiga"]').value;
    var pass_nova = document.querySelector('input[name="pass_nova"]').value;
    var pass_confirme = document.querySelector('input[name="pass_confirme"]').value;
    var modal_erro = document.getElementById("modal_erro");
    var text = document.getElementById("modalText");

    var data = { pass_antiga, pass_nova, pass_confirme };

    fetch('/change-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data),
    })
      .then(response => {
        // Verifica o código de status da resposta
        if (response.status === 200) {

          window.location.href = '/logout';

        } else {
          return response.text();

        }
      })
      .then(message => {

        text.innerHTML = message;
        modal_erro.style.display = "block";

        // Fecha o modal após 5 segundos
        setTimeout(function () {
          modal_erro.style.display = "none";
        }, 5000);

      })
      .then(data => {
        // Loga o corpo da resposta no console
        console.log('Sucesso:', data);
      })
      .catch((error) => {
        // Loga qualquer erro que ocorra durante a solicitação no console
        console.error('Erro:', error);
      });
  });

  // Use jQuery para fazer uma solicitação AJAX para o servidor
  $(document).ready(function () {
    $.get('http://localhost:3333/perfil/horario', function (data) {
      // Insira a tabela no div com id "tabelaContainer"
      $('#tabelaContainer').html(data);
    });
  });

  // Use jQuery para fazer uma solicitação AJAX para o servidor
  $(document).ready(function () {
    $.get('/perfil', function (data) {
      // Insira a tabela no div com id "tabelaContainer"
      $('#tabelaContainer').html(data);
    });
  });
</script>